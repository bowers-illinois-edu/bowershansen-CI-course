---
title: Statistical Inference for Causal Quantities when the Active Ingredient is not Random
date: '`r format(Sys.Date(), "%B %d, %Y")`'
author: ICPSR 2018 Session 2
bibliography:
 - refs.bib
 - BIB/master.bib
 - BIB/misc.bib
fontsize: 10pt
geometry: margin=1in
graphics: yes
biblio-style: authoryear-comp
output:
  beamer_presentation:
    slide_level: 2
    keep_tex: true
    latex_engine: xelatex
    citation_package: biblatex
    template: icpsr.beamer
    incremental: true
    includes:
        in_header:
           - defs-all.sty
---


<!-- Make this document using library(rmarkdown); render("day12.Rmd") -->


```{r include=FALSE, cache=FALSE}
# Some customization.  You can alter or delete as desired (if you know what you are doing).
# knitr settings to control how R chunks work.
rm(list=ls())

require(knitr)

## This plus size="\\scriptsize" from https://stackoverflow.com/questions/26372138/beamer-presentation-rstudio-change-font-size-for-chunk

knitr::knit_hooks$set(mysize = function(before, options, envir) {
  if (before)
    return(options$size)
})

knit_hooks$set(plotdefault = function(before, options, envir) {
    if (before) par(mar = c(3, 3, .1, .1),oma=rep(0,4),mgp=c(1.5,.5,0))
})

opts_chunk$set(
  tidy=FALSE,     # display code as typed
  echo=TRUE,
  results='markup',
  strip.white=TRUE,
  fig.path='figs/fig',
  cache=FALSE,
  highlight=TRUE,
  width.cutoff=132,
  size='\\scriptsize',
  out.width='.8\\textwidth',
  fig.retina=FALSE,
  message=FALSE,
  comment=NA,
  mysize=TRUE,
  plotdefault=TRUE)

if(!file.exists('figs')) dir.create('figs')

options(digits=4,
	scipen=8,
	width=132
	)
```

```{r eval=FALSE, include=FALSE, echo=FALSE}
## Run this only once and then not again until we want a new version from github
library('devtools')
library('withr')
with_libpaths('./lib', install_github("markmfredrickson/RItools"), 'pre')
```

```{r echo=FALSE}
library(dplyr)
library(RItools,lib.loc="./lib")
```

## Today

\begin{enumerate}
\item Agenda: 
\item Reading:
\item Questions arising from the reading or assignments or life?
\item Recap: 
\end{enumerate}

# But first: Who am I? Who are you?

## Brief Introductions

# But second: An overview of approaches to statistical inference for causal quantities

\begin{frame}{Approach 1: Test Hypotheses about Models of Potential Outcomes}

  \smallskip
  \centering
  \includegraphics[width=.9\textwidth]{images/cartoonFisher.pdf}

\end{frame}


\begin{frame}{Approach 2: Estimate Averages of Potential Outcomes}

  \smallskip
  \centering
  \includegraphics[width=.9\textwidth]{images/cartoonNeyman.pdf}

\end{frame}


\begin{frame}{Approach 3: Predict Potential Outcomes}

  \smallskip
  \centering
  \includegraphics[width=.9\textwidth]{images/cartoonBayes.pdf}

\end{frame}

# And third, some more context: The creation of interpretable comparisons.

## Research designs to aid the creation of interpretable comparisons

   - Randomized experiments (randomized $Z$ changes $y$) <!-- (more precision from reducing heterogeneity in $Y$) -->
     - No systematic differences between groups
     - Known reference distribution for tests of the sharp null and, in large
       samples, the weak null.
   - Instrumental variables (randomized $Z$ changes $D$ which changes $y$)
   - Natural Experiments / Discontinuities (one $X$ creates $Z$ which \ldots)
   - Semi-/Non-parametric Covariance Adjustment ($Z$ out of our control, but we can choose how to organize and observe given $X$) (matching and difference-in-differences)
   - Parametric covariance adjustment (same as above, but with a model for statistical adjustment, i.e. "controlling for")


# Now: Instruments, the ITT and CACE/LATE

## Instruments, the ITT and CACE/LATE

**Context:** An NGO invites you to help design and evaluate a program to increase donations involving in-person, door-to-door, discussions about the canvasser's own personal experiences. Building rapport with another person should increase willingness to donate, according to the NGO.

**Opportunity for learning about theory** You know have been interested in
understanding why and how social norms influence behavior. So, you ask to
that canvassers appeal to a descriptive social norm ("other people we have
spoken with agree") toward the end of the discussion.

**Design:** The NGO randomizes visits by canvassers to a set of addresses and
measures the amount pledged at each house.

**Analysis:** The NGO cares about the cost effectiveness of the approach. Did
it work? You (and the NGO should care) about **why** it worked (or did not
work).


## A simulation to understand the design and analysis

Setting up the simulation and analysis before going into the field.

```{r}
library(randomizr)
set.seed(20180730)
n <- 1000
x <- rnorm(n,mean=45,sd=2)
y0tmp <- round(rnorm(n,mean=0,sd=10))
y0 <- ifelse(y0tmp>=0,y0tmp,0)
Z <- complete_ra(n)
```

Imagine that **assignment** caused the outcome to differ:

```{r}

taubar <- 1
y1 <- y0 + taubar

Y <- Z * y1 + (1-Z) * y0

taubarhat <- mean(Y[Z==1]) - mean(Y[Z==0])
## or taubarhat <- coef(lm(Y~Z))[["Z"]]

```

But what if we want to know about the effect of experiencing the treatment,
the effect of talking with a canvasser $D=1$ versus the effect of being assigned to
have that talk ($Z=1$).





## Summary of the Day

  - More than one way to use what we observe to reason about potential
    outcomes: testing, estimating, predicting
  - An instrument moves a dose. The effect of the dose is specific, or local,
    to those who took a dose, to those who experienced the treatment.
  - 
  - 
  - 

## References

